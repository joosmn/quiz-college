<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8">
    <title>Jeu Quiz Coll√®ge</title> <!-- Titre de l'onglet du navigateur -->
    <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Adaptation mobile -->
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Poppins:wght@400;600&display=swap" rel="stylesheet"> <!-- Importation de polices -->
    <audio id="sound-plus" src="https://www.soundjay.com/button/beep-07.wav"></audio>
    <audio id="sound-minus" src="https://www.soundjay.com/button/beep-10.wav"></audio>
    <style>
      /* Style g√©n√©ral du site */
      html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        font-family: 'Poppins', sans-serif; /* Police principale */
        background-color: #ffe4e1; /* Couleur de fond pastel */
        color: white; /* Couleur texte */
        text-align: center;
        min-height: 100vh;
      }
      .container {
        background-color: #1e1e1e; /* Fond sombre pour le cadre principal */
        border-radius: 12px;
        max-width: 1100px;
        margin: 2rem auto;
        padding: 2rem;
        box-shadow: 0 0 25px rgba(0,0,0,0.6); /* Ombre */
      }
      h1 {
        font-family: 'Bebas Neue', cursive;
        font-size: 3.5rem;
        color: #ffd700; /* Jaune dor√© */
        letter-spacing: 2px;
        margin: 1rem 0;
      }
      input, select, button {
        padding: 10px;
        margin: 8px;
        font-size: 1rem;
        border-radius: 8px;
        border: none;
        outline: none;
      }
      input, select {
        width: 220px;
        background-color: #f3f3f3;
        color: #333;
      }
      select {
        background-color: #ffd700;
        color: #000;
        font-weight: bold;
        text-align: center;
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        padding-right: 30px;
        background-image: url('https://cdn-icons-png.flaticon.com/512/32/32195.png'); /* fl√®che dropdown */
        background-repeat: no-repeat;
        background-position: right 10px center;
        background-size: 15px;
      }
      button {
        background-color: #ffd700;
        color: #000;
        cursor: pointer;
        font-weight: bold;
        transition: background-color 0.3s ease;
      }
      button:hover {
        background-color: #ffa500; /* Orange au survol */
      }
      .logout, .reset {
        background-color: #ef4444; /* Rouge */
        color: white;
      }
      .header-bar {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 1rem;
      }
      .header-bar img {
        height: 70px;
      }
      .welcome-message {
        font-size: 1.2rem;
        margin-bottom: 2rem;
        color: #f0f0f0;
      }
      .student-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
        gap: 0.6rem;
        justify-content: center;
        align-items: center;
        padding: 0.5rem;
        width: 100%;
        height: calc(100vh - 220px); /* timer + bouton */
        overflow: hidden;
      }
      
      .card {
        background: #1e293b;
        border: 2px solid #ffd700;
        border-radius: 12px;
        padding: 0.5rem;
        min-width: 90px;
        max-width: 120px;
        flex-grow: 1;
        text-align: center;
        font-size: 0.85rem;
      }
      
      .avatar {
        width: 36px;
        height: 36px;
        margin: auto;
        margin-bottom: 0.3rem;
        object-fit: cover;
        border-radius: 50%;
      }
      
      .card button {
        padding: 4px 8px;
        margin: 2px;
        font-size: 0.75rem;
        border-radius: 6px;
      }

      .card p.score {
        font-size: 1.8rem;
        font-weight: bold;
        margin: 0.5rem 0;
      }

      .hidden {
        display: none;
      }
      ol, ul {
        text-align: left;
        display: inline-block;
        color: #ffffff;
      }
      .admin-section {
        margin-top: 3rem;
        padding-top: 1rem;
        border-top: 2px solid #ffd700;
      }
      .admin-section h2 {
        color: #ffd700;
      }
      .admin-logo {
        cursor: pointer;
        margin-top: 2rem;
      }
      .admin-logo img {
        height: 60px;
      }
      .delete-btn {
        margin-left: 10px;
        cursor: pointer;
        color: #ef4444;
        font-weight: bold;
      }
      #liveGame {
        margin-top: 2rem;
        padding: 1rem;
        background-color: #111;
        border-radius: 10px;
      }
      #timer {
        font-size: 2rem;
        margin: 1rem 0;
        color: #ffd700;
      }
      #buzzerSound, #endSound {
        display: none; /* Les sons ne sont pas visibles */
      }
      .class-table {
        margin-top: 1rem;
        border-collapse: collapse;
        width: 100%;
      }
      .class-table th, .class-table td {
        border: 1px solid #ffd700;
        padding: 10px;
        text-align: left;
      }
      .class-table th {
        background-color: #ffd700;
        color: #000;
      }
      .checkbox-group {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: center;
        margin: 1rem 0;
      }
      
      .checkbox-group label {
        background-color: #2d3748;
        border: 1px solid #ffd700;
        border-radius: 8px;
        padding: 8px 12px;
        color: white;
        cursor: pointer;
        transition: background-color 0.3s;
      }
      
      .checkbox-group input[type="checkbox"] {
        display: none;
      }
      
      .checkbox-group input[type="checkbox"]:checked + span {
        background-color: #ffd700;
        color: #000;
        font-weight: bold;
      }
      
      .class-logo {
        display: inline-block;
        margin: 10px;
        cursor: pointer;
        border: 2px solid #ffd700;
        border-radius: 12px;
        padding: 10px;
        background-color: #2d3748;
      }
      .class-logo:hover {
        background-color: #ffd700;
        color: #000;
      }
      .checkbox-group {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: center;
        margin: 1rem 0;
      }
      .checkbox-group label {
        background-color: #2d3748;
        border: 1px solid #ffd700;
        border-radius: 8px;
        padding: 8px 12px;
        color: white;
        cursor: pointer;
        transition: background-color 0.3s;
      }
      .checkbox-group input[type="checkbox"] {
        display: none;
      }
      .checkbox-group input[type="checkbox"]:checked + span {
        background-color: #ffd700;
        color: #000;
        font-weight: bold;
      }
            @keyframes fadeIn {
        from { opacity: 0; transform: scale(0.95); }
        to { opacity: 1; transform: scale(1); }
      }
      
            
      .end-game-btn {
        margin-top: 1rem;
        padding: 8px 16px;
        font-size: 1rem;
        background-color: #ef4444;
        border: none;
        border-radius: 8px;
        cursor: pointer;
      }
      
      .end-game-btn:hover {
        background-color: #dc2626;
      }

      #globalRanking {
        list-style: none;
        padding: 0;
        margin-top: 1.5rem;
        max-width: 500px;
        margin-left: auto;
        margin-right: auto;
        text-align: left;
      }
      
      #globalRanking li {
        background: #2d3748;
        border: 2px solid #ffd700;
        border-radius: 10px;
        margin-bottom: 12px;
        padding: 12px 18px;
        font-size: 1.1rem;
        color: #fff;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: transform 0.2s ease-in-out;
      }
      
      #globalRanking li:hover {
        transform: scale(1.03);
        background-color: #3b4252;
      }
      
      .rank-number {
        font-weight: bold;
        color: #ffd700;
        margin-right: 10px;
      }
      .reset-ranking-btn {
        background-color: #ef4444;
        color: white;
        padding: 10px 20px;
        margin-top: 1rem;
        border-radius: 10px;
        border: none;
        font-weight: bold;
        cursor: pointer;
        transition: background-color 0.3s;
      }
      
      .reset-ranking-btn:hover {
        background-color: #dc2626;
      }

      .student-class {
        font-style: italic;
        font-size: 0.9rem;
        color: #cbd5e1;
        margin: 0.3rem 0;
      }

    
/* Design am√©lior√© pour la page de partie en direct */
      .fullscreen-game {
        position: fixed;
        inset: 0;
        background: linear-gradient(135deg, #0f172a, #1e293b);
        color: #fff;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        padding: 1rem;
        z-index: 9999;
        box-sizing: border-box;
        overflow: hidden;
        border-radius: 0; /* ‚úÖ ajoute √ßa ou supprime toute bordure */
      }
.end-game-btn {
  margin-top: 2rem;
  padding: 12px 28px;
  font-size: 1.2rem;
  background-color: #ef4444;
  color: white;
  border-radius: 10px;
  cursor: pointer;
}
.end-game-btn:hover {
  background-color: #dc2626;
}
      #timer {
        position: sticky;
        top: 0;
        background-color: #1e293b;
        padding: 0.5rem;
        font-size: 1.5rem;
        z-index: 10;
      }
      
      .end-game-btn {
        position: sticky;
        bottom: 0;
        background-color: #ef4444;
        padding: 10px 20px;
        margin-top: 1rem;
        z-index: 10;
      }

      .medal {
        font-size: 1.8rem;
        margin-bottom: 0.2rem;
        animation: pop 0.6s ease-in-out infinite alternate;
      }
      
      @keyframes pop {
        from { transform: scale(1); }
        to { transform: scale(1.2); }
      }

      .score-big {
        font-size: 2rem;
        font-weight: bold;
      }

      .admin-logo {
        display: none; /* Cach√© par d√©faut */
      }
      .bonus-btn {
        background-color: #4ade80;
        color: #000;
        font-size: 1.1rem;
        padding: 10px 20px;
        border-radius: 8px;
        margin: 10px;
        font-weight: bold;
        cursor: pointer;
      }
      
      .bonus-btn:hover {
        background-color: #22c55e;
      }

      .toggle-mode {
        display: flex;
        justify-content: center;
        gap: 1rem;
      }
      
      .toggle-mode input[type="radio"] {
        display: none;
      }
      
      .toggle-label {
        padding: 10px 20px;
        background-color: #2d3748;
        color: white;
        border: 2px solid #ffd700;
        border-radius: 10px;
        cursor: pointer;
        font-weight: bold;
        transition: background-color 0.3s ease, transform 0.2s ease;
      }
      
      .toggle-label:hover {
        background-color: #ffd700;
        color: #000;
        transform: scale(1.05);
      }
      
      .toggle-mode input[type="radio"]:checked + .toggle-label {
        background-color: #ffd700;
        color: #000;
      }
      .game-setup {
        background: linear-gradient(to bottom right, #1f2937, #111827);
        border: 3px solid #ffd700;
        border-radius: 15px;
        box-shadow: 0 0 25px rgba(255, 215, 0, 0.2);
        padding: 2rem;
        max-width: 600px;
        margin: 2rem auto;
        text-align: center;
        transition: transform 0.2s ease;
      }
      
      .game-setup:hover {
        transform: scale(1.01);
      }
      
      .game-setup h2 {
        font-size: 2rem;
        margin-bottom: 1.5rem;
        color: #ffd700;
        border-bottom: 2px dashed #ffd700;
        padding-bottom: 0.5rem;
      }

      #classRanking {
        list-style: none;
        padding: 0;
        margin-top: 1rem;
        max-width: 500px;
        margin-left: auto;
        margin-right: auto;
        text-align: left;
      }
      
      #classRanking li {
        background: #334155;
        border: 2px solid #ffd700;
        border-radius: 10px;
        margin-bottom: 10px;
        padding: 10px 15px;
        font-size: 1rem;
        color: #fff;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      #rankingSection ol {
        list-style: none;
        padding: 0;
        margin-top: 1rem;
        text-align: left;
      }
      
      #rankingSection li {
        background: #2d3748;
        border: 2px solid #ffd700;
        border-radius: 10px;
        margin-bottom: 12px;
        padding: 12px 18px;
        font-size: 1.1rem;
        color: #fff;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: transform 0.2s ease-in-out;
      }
      
      #rankingSection li:hover {
        transform: scale(1.03);
        background-color: #3b4252;
      }

      #currentGameRanking {
        margin-top: 2rem;
        padding: 1rem;
        background-color: #1e1e1e;
        border-radius: 12px;
        box-shadow: 0 0 20px rgba(0,0,0,0.5);
        max-width: 700px;
        margin-left: auto;
        margin-right: auto;
      }
      .class-card {
        background-color: #1e293b;
        border: 2px solid #ffd700;
        border-radius: 12px;
        padding: 1rem;
        margin-bottom: 1.5rem;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      }
      
      .class-card h3 {
        margin-top: 0;
        color: #ffd700;
        font-size: 1.4rem;
        border-bottom: 1px solid #ffd700;
        padding-bottom: 0.5rem;
      }
      
      .student-list {
        list-style-type: none;
        padding: 0;
        margin: 0;
        margin-top: 0.5rem;
      }
      
      .student-list li {
        background-color: #334155;
        color: white;
        padding: 0.5rem 0.75rem;
        margin-bottom: 6px;
        border-radius: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      
      .student-list button {
        background-color: #ef4444;
        border: none;
        color: white;
        padding: 4px 8px;
        border-radius: 6px;
        cursor: pointer;
      }
      
      .student-list button:hover {
        background-color: #dc2626;
      }
      
      .class-card {
        background-color: #1e293b;
        border: 2px solid #ffd700;
        border-radius: 12px;
        margin-bottom: 1rem;
        overflow: hidden;
        transition: all 0.3s ease-in-out;
      }
      
      .class-card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem;
        cursor: pointer;
        background-color: #111827;
      }
      
      .class-card-header h3 {
        color: #ffd700;
        margin: 0;
        font-size: 1.2rem;
      }
      
      .class-card-header button {
        background-color: #4ade80;
        color: black;
        border: none;
        padding: 6px 12px;
        border-radius: 6px;
        font-weight: bold;
        cursor: pointer;
      }
      
      .class-card-header button:hover {
        background-color: #22c55e;
      }
      
      .student-list {
        list-style-type: none;
        padding: 0;
        margin: 0;
        display: none;
        background-color: #1e293b;
      }
      
      .student-list.active {
        display: block;
        padding: 1rem;
      }
      
      .student-list li {
        background-color: #334155;
        color: white;
        padding: 6px 12px;
        margin-bottom: 6px;
        border-radius: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      
      .student-list li button {
        background-color: #ef4444;
        border: none;
        color: white;
        padding: 4px 8px;
        border-radius: 6px;
        cursor: pointer;
      }
      
      .student-list li button:hover {
        background-color: #dc2626;
      }
      
      body.fullscreen-mode {
        overflow: hidden;
        height: 100vh;
      }

      @keyframes fadeZoomIn {
        from {
          opacity: 0;
          transform: scale(0.9);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }
      
      .fullscreen-game.animate-in {
        animation: fadeZoomIn 0.5s ease-out;
      }

      @keyframes slideFadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      
      .card {
        opacity: 0;
        animation: slideFadeIn 0.5s ease forwards;
      }

      .card.leader {
        border: 3px solid gold;
        box-shadow: 0 0 10px gold;
      }



</style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  </head>
  <body>
    <!-- Conteneur principal du site -->

      <div class="container" id="mainInterface">
        
      <!-- En-t√™te avec logo, titre et ic√¥nes -->
      <div class="header-bar">
        <img src="https://cdn-icons-png.flaticon.com/512/2948/2948037.png" alt="Quiz logo"> <!-- Logo √† gauche -->
        <h1>üéì Quiz du Coll√®ge Jean Papon üéì</h1> <!-- Titre du site -->
        <img src="https://cdn-icons-png.flaticon.com/512/2965/2965567.png" alt="Buzzer logo"> <!-- Logo √† droite -->
      </div>
      
      <!-- Message de bienvenue -->
      <p class="welcome-message">
        Bienvenue sur la plateforme interactive pour tester tes connaissances et buzzer plus vite que les autres !
      </p>
      
      <!-- Formulaire de connexion -->
      <div id="login">
        <input type="text" id="username" placeholder="Nom d'utilisateur"> <!-- Champ identifiant -->
        <input type="password" id="password" placeholder="Mot de passe"> <!-- Champ mot de passe -->
        <button onclick="login()">Se connecter</button> <!-- Bouton de connexion -->
      </div>
      
      <!-- Application apr√®s connexion -->
      <div id="app" class="hidden">
        <p id="welcome"></p> <!-- Message de bienvenue personnalis√© -->
        <button onclick="logout()" class="logout">D√©connexion</button> <!-- Bouton de d√©connexion -->
        
        <div class="game-setup">
          <h2>üéì Nouvelle Partie</h2>

        <!-- Cr√©ation et lancement de partie -->
        <div>
          <input type="text" id="gameName" placeholder="Nom de la partie"> <!-- Nom personnalis√© -->
          <div class="setup-row">
            <label style="margin-bottom: 0.6rem;">Mode de jeu :</label>
            <div class="toggle-mode">
              <input type="radio" id="soloMode" name="gameMode" value="solo" checked>
              <label for="soloMode" class="toggle-label">üéØ Solo</label>
              
              <input type="radio" id="duoMode" name="gameMode" value="duo">
              <label for="duoMode" class="toggle-label">ü§ù Duo</label>
              
            </div>
          </div>
          
          <select id="subject"> <!-- Choix de la mati√®re -->
            <option value="Maths">Maths</option>
            <option value="Fran√ßais">Fran√ßais</option>
            <option value="Histoire">Histoire</option>
            <option value="SVT">SVT</option>
            <option value="Anglais">Anglais</option>
          </select>

        </div>
        </div>
        
        <!-- Section de s√©lection des joueurs √† lancer -->
        <div id="playerSelection" class="hidden">
          <h3>üë• S√©lection des joueurs</h3>
          <div id="classSelection"></div>
          <div id="studentCheckboxes" class="checkbox-group"></div>
          <button onclick="resetStudentSelections()">üîÅ Tout d√©s√©lectionner</button>
          
          <h3>Duos</h3>
          <button onclick="createDuo()">üë• Former un duo avec 2 √©l√®ves s√©lectionn√©s</button>
          <ul id="duoList"></ul>

          <button onclick="startLiveGame()">D√©marrer la partie</button>
        </div>
        </div>

        
        <!-- Affichage de la partie en cours -->
        <div id="liveGame" class="hidden">
          <h2>üéÆ Partie en direct</h2>
          <p id="gameDetails"></p> <!-- D√©tails partie -->
          <div id="timer">00:00</div> <!-- Chronom√®tre -->
          <div id="livePlayers" class="student-cards"></div> <!-- Cartes des joueurs en live -->
          <button onclick="activateSuperBonus()" class="bonus-btn">üéÅ SUPER BONUS</button>
          <button onclick="endLiveGameWithWinner()">üèÅ Cl√¥turer & Annoncer le gagnant</button>
          
          
        </div>
        <div id="currentGameRanking" class="hidden">
          <h2>üéØ Classement de la partie</h2>
          <table class="class-table">
            <thead>
              <tr>
                <th>Rang</th>
                <th>Nom</th>
                <th>Score</th>
              </tr>
            </thead>
            <tbody id="currentGameRankingTable">
              <!-- Classement dynamique -->
            </tbody>
          </table>
        </div>

        
                
        <!-- Classement g√©n√©ral -->
        <button id="toggleRankingBtn" onclick="toggleRankingSection()">Afficher les classements</button>


        <div id="rankingSection" style="display: none; justify-content: center; gap: 2rem; flex-wrap: wrap;">
          <div style="flex: 1; min-width: 300px;">
            <h2>üèÜ Classement G√©n√©ral</h2>
            <ol id="globalRanking"></ol>
          </div>
          
          <div style="flex: 1; min-width: 300px;">
            <h2>üè´ Classement des Classes</h2>
            <ol id="classRanking"></ol>
          </div>
          
          <div style="flex: 1; min-width: 300px;">
            <h2>üìö Classement par Mati√®re</h2>
            <select id="subjectRankingSelect" onchange="updateSubjectRanking()" style="margin-bottom: 10px;">
              <option value="Maths">Maths</option>
              <option value="Fran√ßais">Fran√ßais</option>
              <option value="Histoire">Histoire</option>
              <option value="SVT">SVT</option>
              <option value="Anglais">Anglais</option>
            </select>
            <ol id="subjectRanking"></ol>
          </div>
        </div>


        <!-- Bouton vers l'administration -->
        <div class="admin-logo" onclick="toggleAdmin()">
          <img src="https://cdn-icons-png.flaticon.com/512/1828/1828774.png" alt="Administration">
          <p>Administration</p>
        </div>
        
        
        <!-- Section administration -->
        <div class="admin-section hidden" id="adminSection">
          
          
          <h2>üîß Administration</h2>
          <button onclick="exportData()">üì§ Exporter les donn√©es</button>
          <input type="file" id="importFile" accept=".json">
          <button onclick="importData()">üì• Importer les donn√©es</button>
          <button onclick="restoreFromBackup()" style="background-color:#3b82f6;color:white;padding:10px 20px;margin-top:10px;border-radius:8px;font-weight:bold;cursor:pointer;">
            üîÅ Restaurer depuis la derni√®re sauvegarde auto
          </button>


        

          

          
          <!-- Formulaire pour cr√©er une classe -->
          <button onclick="resetRanking()" class="reset-ranking-btn">üîÑ R√©initialiser le classement</button>
          
          <div>
            <input type="text" id="newClassName" placeholder="Nom de la classe">
            <button onclick="createClass()">Cr√©er une classe</button>
          </div>
          <div>
            <select id="classSelector"></select>
            <input type="text" id="newStudentName" placeholder="Nom de l'√©l√®ve">
            <button onclick="createStudent()">Ajouter un √©l√®ve √† la classe</button>
          </div>
          <p>Nombre total d'√©l√®ves : <span id="totalStudents"></span></p>
          <div id="allStudentsList"></div>
          
          <h3>‚ûï Ajouter des points manuellement</h3>
          <select id="manualClassSelect"></select>
          <select id="manualStudentSelect"></select>
          <input type="number" id="manualPoints" placeholder="Points √† ajouter">
          <button onclick="addManualPoints()">Ajouter</button>

          
          <hr>
          <h2>üìú Historique des parties</h2>
          <div id="historyContainer"></div>
          <button onclick="exportHistoryToPDF()" style="margin-bottom: 1rem; background-color:#22c55e; color:black; border:none; padding:8px 14px; border-radius:8px; font-weight:bold; cursor:pointer;">
            üìÑ Exporter l‚Äôhistorique en PDF
          </button>
          
          
        </div>
        
        

      
      <!-- Sons des buzzers -->
      <audio id="buzzerSound" src="https://www.soundjay.com/button/beep-07.wav"></audio>
      <audio id="endSound" src="https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3"></audio>
    <script>
      
      let manualDuos = [];
      
      function createDuo() {
        const selected = Array.from(document.querySelectorAll('#studentCheckboxes input:checked'));
        if (selected.length !== 2) {
          return alert("Coche exactement 2 √©l√®ves pour former un duo.");
        }
        
        const name1 = selected[0].value;
        const name2 = selected[1].value;
        
        if (manualDuos.flat().includes(name1) || manualDuos.flat().includes(name2)) {
          return alert("Un des √©l√®ves est d√©j√† dans un duo.");
        }
        
        manualDuos.push([name1, name2]);
        selected.forEach(cb => cb.checked = false);
        
        const li = document.createElement("li");
        li.textContent = ${name1} & ${name2};
        document.getElementById("duoList").appendChild(li);
      }

      // Liste des utilisateurs autoris√©s √† se connecter avec leur mot de passe
      const users = {
        "Jordan": "admin123",
        "Marie": "marie123",
        "Fabienne": "fabienne123"
      };
      const classes = JSON.parse(localStorage.getItem("classes") || "{}");
      const globalScores = JSON.parse(localStorage.getItem("globalScores") || "{}");
      const subjectScores = JSON.parse(localStorage.getItem("subjectScores") || "{}");
      


      let livePlayers = [];
      let superBonusActive = false;
      let liveInterval;
      let time = 0;
      
      
      
      let currentUser = null;
      
      function login() {
  
        
        const username = document.getElementById("username").value.trim();
        const password = document.getElementById("password").value.trim();
        const users = {
          "Jordan": "admin123",
          "Marie": "marie123",
          "Fabienne": "fabienne123"
        };
        
        if (!users[username] || users[username] !== password) {
          return alert("Nom d'utilisateur ou mot de passe incorrect.");
        }
        
        currentUser = username;
        
        document.getElementById("login").classList.add("hidden");
        document.getElementById("app").classList.remove("hidden");
        document.getElementById("welcome").textContent = Bienvenue, ${username} !;
        
        // Si l'utilisateur est admin, afficher le bouton admin
        const isAdmin = username === "Jordan";
        document.querySelector(".admin-logo").style.display = isAdmin ? "block" : "none";
        
        updateAdmin();
        updateGlobalRanking();
        updateQuizStats();
        
        document.getElementById("rankingSection").classList.remove("hidden");
        
      }
      
      function logout() {
        location.reload();
      }
      function resetRanking() {
        const confirmReset = confirm("Es-tu s√ªr de vouloir r√©initialiser tout le classement ?");
        if (confirmReset) {
          localStorage.removeItem("globalScores");
          alert("Le classement a √©t√© r√©initialis√© !");
          location.reload();
        }
      }

      function createClass() {
        const className = document.getElementById("newClassName").value.trim();
        if (className && !classes[className]) {
          classes[className] = [];
          localStorage.setItem("classes", JSON.stringify(classes));
          updateAdmin();
        }
      }
      
      function createStudent() {
        const className = document.getElementById("classSelector").value;
        const studentName = document.getElementById("newStudentName").value.trim();
        if (className && studentName && !classes[className].includes(studentName)) {
          classes[className].push(studentName);
          localStorage.setItem("classes", JSON.stringify(classes));
          updateAdmin();
        }
      }
      
      function updateAdmin() {
        const selector = document.getElementById("classSelector");
        selector.innerHTML = "";
        let count = 0;
        for (const className in classes) {
          const option = document.createElement("option");
          option.value = className;
          option.textContent = className;
          selector.appendChild(option);
          count += classes[className].length;
        }
        document.getElementById("totalStudents").textContent = count;
        
        const allList = document.getElementById("allStudentsList");
        allList.innerHTML = "";
        
        for (const className in classes) {
          const card = document.createElement("div");
          card.className = "class-card";
          
          const header = document.createElement("div");
          header.className = "class-card-header";
          
          const title = document.createElement("h3");
          title.textContent = ${className} (${classes[className].length});
          
          
          const addBtn = document.createElement("button");
          addBtn.textContent = "‚ûï";
          addBtn.onclick = () => {
            const studentName = prompt(Nom de l'√©l√®ve √† ajouter dans ${className} :);
            if (studentName && !classes[className].includes(studentName)) {
              classes[className].push(studentName);
              localStorage.setItem("classes", JSON.stringify(classes));
              updateAdmin();
            }
          };
          
          header.appendChild(title);
          header.appendChild(addBtn);
          
          const studentList = document.createElement("ul");
          studentList.className = "student-list";
          
          classes[className].forEach((student, index) => {
            const li = document.createElement("li");
            li.innerHTML = 
      ${student}
      <button onclick="deleteStudent('${className}', ${index})">Supprimer</button>
    ;
            studentList.appendChild(li);
          });
          
          // Toggle menu on header click
          header.onclick = () => {
            studentList.classList.toggle("active");
          };
          
          card.appendChild(header);
          card.appendChild(studentList);
          allList.appendChild(card);
        }
      }
      
      const classSelect = document.getElementById("manualClassSelect");
      const studentSelect = document.getElementById("manualStudentSelect");
      classSelect.innerHTML = "";
      studentSelect.innerHTML = "";
      
      for (const className in classes) {
        const opt = document.createElement("option");
        opt.value = className;
        opt.textContent = className;
        classSelect.appendChild(opt);
      }
      
      classSelect.onchange = () => {
        const selectedClass = classSelect.value;
        studentSelect.innerHTML = "";
        classes[selectedClass].forEach(name => {
          const opt = document.createElement("option");
          opt.value = name;
          opt.textContent = name;
          studentSelect.appendChild(opt);
        });
      };
      classSelect.dispatchEvent(new Event("change"));

      function deleteStudent(className, index) {
        classes[className].splice(index, 1);
        localStorage.setItem("classes", JSON.stringify(classes));
        updateAdmin();
      }
      
      function openPlayerSelection() {
        const classDiv = document.getElementById("classSelection");
        const studentDiv = document.getElementById("studentCheckboxes");
        classDiv.innerHTML = "";
        studentDiv.innerHTML = "";
        
        const visitedClasses = new Set();
        
        // üî¢ Cr√©e le compteur une seule fois
        let countDiv = document.getElementById("studentCount");
        if (!countDiv) {
          countDiv = document.createElement("div");
          countDiv.id = "studentCount";
          countDiv.style.marginTop = "0.5rem";
          countDiv.style.fontWeight = "bold";
          countDiv.style.color = "#ffd700";
          studentDiv.parentElement.insertBefore(countDiv, studentDiv);
        }
        
        for (const className in classes) {
          const logo = document.createElement("div");
          logo.className = "class-logo";
          logo.textContent = className;
          
          logo.onclick = () => {
            visitedClasses.add(className);
            
            // üîÅ Garde les √©l√®ves d√©j√† s√©lectionn√©s
            const selectedNames = new Set(
              Array.from(studentDiv.querySelectorAll('input[type="checkbox"]:checked'))
              .map(cb => cb.value)
            );
            
            studentDiv.innerHTML = "";
            
            // ‚ûï R√©affiche les √©l√®ves s√©lectionn√©s
            for (const otherClass in classes) {
              classes[otherClass].forEach(name => {
                if (selectedNames.has(name)) {
                  const label = document.createElement("label");
                  const checkbox = document.createElement("input");
                  checkbox.type = "checkbox";
                  checkbox.value = name;
                  checkbox.checked = true;
                  checkbox.addEventListener("change", updateStudentCount);
                  
                  const span = document.createElement("span");
                  span.textContent = ${name} (${otherClass});
                  
                  label.appendChild(checkbox);
                  label.appendChild(span);
                  studentDiv.appendChild(label);
                }
              });
            }
            
            // ‚ûï Ajoute les nouveaux √©l√®ves de la classe cliqu√©e
            classes[className].forEach(name => {
              if (!selectedNames.has(name)) {
                const label = document.createElement("label");
                const checkbox = document.createElement("input");
                checkbox.type = "checkbox";
                checkbox.value = name;
                checkbox.addEventListener("change", updateStudentCount);
                
                const span = document.createElement("span");
                span.textContent = ${name} (${className});
                
                label.appendChild(checkbox);
                label.appendChild(span);
                studentDiv.appendChild(label);
              }
            });
            
            // üü® Marque visuellement les classes d√©j√† visit√©es
            document.querySelectorAll(".class-logo").forEach(el => {
              if (visitedClasses.has(el.textContent)) {
                el.style.backgroundColor = "#fef08a";
                el.style.color = "#000";
              }
            });
            
            updateStudentCount(); // üì¢ met √† jour le compteur apr√®s chaque clic
          };
          
          classDiv.appendChild(logo);
        }
        
        // üóëÔ∏è Bouton pour tout effacer
        const resetBtn = document.createElement("button");
        resetBtn.textContent = "üóëÔ∏è Tout effacer";
        resetBtn.style.marginTop = "1rem";
        resetBtn.style.backgroundColor = "#ef4444";
        resetBtn.style.color = "#fff";
        resetBtn.style.borderRadius = "8px";
        resetBtn.style.padding = "8px 14px";
        resetBtn.style.cursor = "pointer";
        resetBtn.onclick = () => {
          studentDiv.innerHTML = "";
          countDiv.textContent = "";
          visitedClasses.clear();
          document.querySelectorAll(".class-logo").forEach(el => {
            el.style.backgroundColor = "#2d3748";
            el.style.color = "#fff";
          });
        };
        
        studentDiv.parentElement.appendChild(resetBtn);
        document.getElementById("playerSelection").classList.remove("hidden");
      }


      function updateStudentCount() {
        const count = document.querySelectorAll('#studentCheckboxes input[type="checkbox"]:checked').length;
        const countDiv = document.getElementById("studentCount");
        if (countDiv) {
          countDiv.textContent = üë• ${count} √©l√®ve${count > 1 ? 's' : ''} s√©lectionn√©${count > 1 ? 's' : ''};
        }
      }


      
      function startLiveGame() {
        const gameName = document.getElementById("gameName").value.trim();
        const subject = document.getElementById("subject").value;
        const selected = Array.from(document.querySelectorAll('#studentCheckboxes input:checked'));
        const isDuoMode = document.getElementById("duoMode").checked;
        
        if (!gameName || !subject || selected.length === 0) {
          return alert("Remplissez tous les champs et s√©lectionnez des joueurs.");
        }
        
        if (isDuoMode && selected.length % 2 !== 0) {
          return alert("En mode duo, s√©lectionnez un nombre pair d'√©l√®ves.");
        }
        
        livePlayers = [];
        
        if (isDuoMode) {
          for (let i = 0; i < selected.length; i += 2) {
            const name1 = selected[i].value;
            const name2 = selected[i + 1].value;
            
            livePlayers.push({
              name: ${name1} & ${name2},
              score: 0,
              isDuo: true,
              members: [name1, name2],
              avatar: https://api.dicebear.com/7.x/thumbs/svg?seed=${name1}-${name2}
            });
          }
        } else {
          const alreadyInDuo = manualDuos.flat();
          livePlayers = [];
          
          // Ajout des duos
          manualDuos.forEach(([name1, name2]) => {
            livePlayers.push({
              name: ${name1} & ${name2},
              score: 0,
              isDuo: true,
              members: [name1, name2],
              avatar: https://api.dicebear.com/7.x/thumbs/svg?seed=${name1}-${name2}
            });
          });
          
          // Ajout des solos restants
          selected.forEach(cb => {
            if (!alreadyInDuo.includes(cb.value)) {
              livePlayers.push({
                name: cb.value,
                score: 0,
                isDuo: false,
                avatar: https://api.dicebear.com/7.x/thumbs/svg?seed=${cb.value}
              });
            }
          });

        }
        
        // üî• Active la vue en plein √©cran
        document.getElementById("playerSelection").classList.add("hidden");
        document.getElementById("app").classList.add("hidden");
        
        document.getElementById("liveGame").classList.remove("hidden");
        document.getElementById("liveGame").classList.add("fullscreen-game");
        document.getElementById("liveGame").classList.add("animate-in");
        setTimeout(() => {
          document.getElementById("liveGame").classList.remove("animate-in");
        }, 600);

        
        document.body.classList.add("fullscreen-mode"); // ‚úÖ bloque scroll sur body
        window.scrollTo(0, 0); // ‚úÖ force scroll en haut
        
        document.getElementById("gameDetails").textContent = Partie : ${gameName} | Mati√®re : ${subject};
        updateLivePlayers();
        startTimer();
      }
      
      function updateLivePlayers() {
        const container = document.getElementById("livePlayers");
        container.innerHTML = "";
        
        let bestScore = Math.max(...livePlayers.map(p => p.score));
        
        livePlayers.forEach(player => {
          const isLeader = player.score === bestScore && bestScore > 0;
          const medalHTML = isLeader ? <div class="medal">ü•á</div> : "";
          
          const div = document.createElement("div");
          div.className = "card";
          div.classList.remove("leader"); // pour r√©initialiser
          
          
          div.innerHTML = 
      ${medalHTML}
      <img src="${player.avatar}" class="avatar">
      <h3>${player.name}</h3>
      <p id="score-${player.name}" class="score-big zero">${player.score} pts</p>

      <div class="progress-bar">
        <div id="bar-${player.name}" class="progress-fill" style="width: ${(player.score / 20) * 100}%"></div>
      </div>
      <button onclick="changeScore('${player.name}', 1)">+1</button>
      <button onclick="changeScore('${player.name}', -1)">-1</button>
    ;
          if (isLeader) div.classList.add("leader");
          
          container.appendChild(div);
        });
      }

      
      function changeScore(name, delta) {
        const player = livePlayers.find(p => p.name === name);
        if (!player) return;
        
        if (superBonusActive && delta > 0) {
          delta = 5;
          superBonusActive = false;
          alert(${name} a gagn√© le SUPER BONUS (+5 points) !);
        }
        
        player.score += delta;
        
        const currentSubject = document.getElementById("subject").value;
        
        if (!subjectScores[currentSubject]) subjectScores[currentSubject] = {};
        
        if (player.isDuo && player.members) {
          player.members.forEach(member => {
            subjectScores[currentSubject][member] = (subjectScores[currentSubject][member] || 0) + delta / 2;
          });
        } else {
          subjectScores[currentSubject][name] = (subjectScores[currentSubject][name] || 0) + delta;
        }
        
        localStorage.setItem("subjectScores", JSON.stringify(subjectScores));

        
        if (player.isDuo && player.members) {
          player.members.forEach(member => {
            globalScores[member] = (globalScores[member] || 0) + delta / 2;
          });
        } else {
          globalScores[name] = (globalScores[name] || 0) + delta;
        }
        
        localStorage.setItem("globalScores", JSON.stringify(globalScores));
        
        // Mise √† jour individuelle
        const scoreEl = document.getElementById("score-" + name);
        if (scoreEl) {
          scoreEl.textContent = ${player.score} pts;
          scoreEl.className = score score-big ${player.score > 0 ? "positive" : (player.score < 0 ? "negative" : "zero")};
        }
        
        const bar = document.getElementById("bar-" + name);
        if (bar) {
          bar.style.width = ${Math.min(100, Math.max(0, (player.score / 20) * 100))}%;
        }
        
        updateLivePlayers(); // ‚úÖ animation au d√©marrage uniquement
        
      }


      
      function endLiveGame() {
        clearInterval(liveInterval); // Stoppe le chrono
        document.getElementById("liveGame").classList.add("hidden");
        document.getElementById("liveGame").classList.remove("fullscreen-game");
        document.getElementById("app").classList.remove("hidden");
        
        const now = new Date();
        const history = JSON.parse(localStorage.getItem("gameHistory") || "[]");
        
        const summary = {
          date: now.toLocaleString(),
          name: document.getElementById("gameName").value.trim(),
          subject: document.getElementById("subject").value,
          players: livePlayers.map(p => ({
            name: p.name,
            score: p.score
          }))
        };
        
        history.push(summary);
        localStorage.setItem("gameHistory", JSON.stringify(history));

        
        localStorage.setItem("globalScores", JSON.stringify(globalScores));
        updateGlobalRanking();
        showCurrentGameRanking(); // üëâ affiche le classement de la partie
        autoExportData();
        // üîí Sauvegarde interne automatique
        const backupData = {
          classes: JSON.parse(localStorage.getItem("classes") || "{}"),
          globalScores: JSON.parse(localStorage.getItem("globalScores") || "{}"),
          subjectScores: JSON.parse(localStorage.getItem("subjectScores") || "{}"),
          gameHistory: JSON.parse(localStorage.getItem("gameHistory") || "[]")
        };
        
        localStorage.setItem("backup", JSON.stringify(backupData));

        livePlayers = [];
        
        document.body.classList.remove("fullscreen-mode");
        
      }
      function showCurrentGameRanking() {
        const table = document.getElementById("currentGameRankingTable");
        table.innerHTML = "";
        
        const sortedPlayers = [...livePlayers].sort((a, b) => b.score - a.score);
        
        sortedPlayers.forEach((player, index) => {
          const row = document.createElement("tr");
          row.innerHTML = 
      <td>${index + 1}</td>
      <td>${player.name}</td>
      <td>${player.score} pts</td>
    ;
          table.appendChild(row);
        });
        
        document.getElementById("currentGameRanking").classList.remove("hidden");
      }

      function updateGlobalRanking() {
        const list = document.getElementById("globalRanking");
        const classList = document.getElementById("classRanking");
        if (!list || !classList) return;
        
        list.innerHTML = "";
        classList.innerHTML = "";
        
        // Classement g√©n√©ral individuel
        Object.entries(globalScores)
        .sort((a, b) => b[1] - a[1])
        .forEach(([name, score]) => {
          const li = document.createElement("li");
          li.textContent = ${name} - ${score} pts;
          list.appendChild(li);
        });
        
        // Classement des classes
        const classScores = {};
        for (const className in classes) {
          const students = classes[className];
          const total = students.reduce((sum, student) => sum + (globalScores[student] || 0), 0);
          classScores[className] = total;
        }
        
        Object.entries(classScores)
        .sort((a, b) => b[1] - a[1])
        .forEach(([className, score]) => {
          const li = document.createElement("li");
          li.textContent = ${className} - ${score} pts;
          classList.appendChild(li);
        });
      }

      
      function toggleAdmin() {
        const admin = document.getElementById("adminSection");
        const ranking = document.getElementById("rankingSection");
        admin.classList.toggle("hidden");
        
        // Cache le classement quand l'administration est ouverte
        if (!admin.classList.contains("hidden")) {
          ranking.classList.add("hidden");
        } else {
          ranking.classList.remove("hidden");
          
          
        }
        
        if (!admin.classList.contains("hidden")) {
          showGameHistory(); // affiche l‚Äôhistorique
        }

      }

      
      function startTimer() {
        time = 0;
        clearInterval(liveInterval);
        liveInterval = setInterval(() => {
          time++;
          const minutes = String(Math.floor(time / 60)).padStart(2, '0');
          const seconds = String(time % 60).padStart(2, '0');
          document.getElementById("timer").textContent = ${minutes}:${seconds};
        }, 1000);
      }
      
      function activateSuperBonus() {
        superBonusActive = true;
        alert("üü° SUPER BONUS activ√© : le prochain bon r√©pondant gagnera +5 points !");
      }

      function updateSubjectRanking() {
        const subject = document.getElementById("subjectRankingSelect").value;
        const list = document.getElementById("subjectRanking");
        
        list.innerHTML = "";
        
        if (!subjectScores[subject]) return;
        
        Object.entries(subjectScores[subject])
        .sort((a, b) => b[1] - a[1])
        .forEach(([name, score]) => {
          const li = document.createElement("li");
          li.textContent = ${name} - ${score} pts;
          list.appendChild(li);
        });
      }
      
      function exportData() {
        const data = {
          classes,
          globalScores
        };
        
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement("a");
        a.href = url;
        a.download = "donnees_quiz.json";
        a.click();
        
        URL.revokeObjectURL(url);
      }
      function importData() {
        const fileInput = document.getElementById("importFile");
        const file = fileInput.files[0];
        if (!file) return alert("Aucun fichier s√©lectionn√©");
        
        const reader = new FileReader();
        reader.onload = function(e) {
          try {
            const importedData = JSON.parse(e.target.result);
            if (importedData.classes && importedData.globalScores) {
              Object.assign(classes, importedData.classes);
              Object.assign(globalScores, importedData.globalScores);
              localStorage.setItem("classes", JSON.stringify(classes));
              localStorage.setItem("globalScores", JSON.stringify(globalScores));
              alert("Import r√©ussi !");
              updateAdmin();
              updateGlobalRanking();
            } else {
              alert("Fichier invalide");
            }
          } catch (err) {
            alert("Erreur lors de la lecture du fichier");
          }
        };
        
        reader.readAsText(file);
      }

      function showGameHistory() {
        const history = JSON.parse(localStorage.getItem("gameHistory") || "[]");
        const container = document.getElementById("historyContainer");
        container.innerHTML = "";
        
        if (history.length === 0) {
          container.innerHTML = "<p>Aucune partie enregistr√©e.</p>";
          return;
        }
        
        history.reverse().forEach((game, index) => {
          const card = document.createElement("div");
          card.style.border = "2px solid #ffd700";
          card.style.borderRadius = "10px";
          card.style.padding = "10px";
          card.style.marginBottom = "10px";
          card.style.background = "#1e293b";
          card.innerHTML = 
      <strong>${game.date}</strong><br>
      Partie : <em>${game.name}</em><br>
      Mati√®re : <em>${game.subject}</em><br>
      Joueurs :
      <ul>
        ${game.players.map(p => <li>${p.name} - ${p.score} pts</li>).join("")}
      </ul>
      <button onclick="deleteGameFromHistory(${history.length - 1 - index})" style="background-color:#ef4444;color:white;border:none;border-radius:6px;padding:5px 10px;cursor:pointer;">üóë Supprimer</button>
    ;
          container.appendChild(card);
        });
      }
      
      function deleteGameFromHistory(index) {
        const history = JSON.parse(localStorage.getItem("gameHistory") || "[]");
        history.splice(index, 1);
        localStorage.setItem("gameHistory", JSON.stringify(history));
        showGameHistory();
      }
      
      async function exportHistoryToPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        const history = JSON.parse(localStorage.getItem("gameHistory") || "[]");
        
        if (history.length === 0) {
          alert("Aucune partie √† exporter.");
          return;
        }
        
        let y = 10;
        doc.setFont("helvetica", "bold");
        doc.setFontSize(16);
        doc.text("Historique des parties - Quiz Coll√®ge", 10, y);
        y += 10;
        
        doc.setFont("helvetica", "normal");
        doc.setFontSize(12);
        
        history.forEach((game, idx) => {
          const header = ${idx + 1}. [${game.date}] ${game.name} - ${game.subject};
          doc.text(header, 10, y);
          y += 7;
          
          game.players.forEach(p => {
            doc.text(   - ${p.name}: ${p.score} pts, 10, y);
            y += 6;
          });
          
          y += 4;
          
          // Nouvelle page si trop bas
          if (y > 270) {
            doc.addPage();
            y = 10;
          }
        });
        
        doc.save("historique_quiz.pdf");
      }
      
      function autoExportData() {
        const data = {
          classes: JSON.parse(localStorage.getItem("classes") || "{}"),
          globalScores: JSON.parse(localStorage.getItem("globalScores") || "{}"),
          subjectScores: JSON.parse(localStorage.getItem("subjectScores") || "{}"),
          gameHistory: JSON.parse(localStorage.getItem("gameHistory") || "[]")
        };
        
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement("a");
        const timestamp = new Date().toISOString().replace(/[:.]/g, "-");
        a.href = url;
        a.download = sauvegarde_quiz_${timestamp}.json;
        a.click();
        
        URL.revokeObjectURL(url);
      }

      function restoreFromBackup() {
        const backup = localStorage.getItem("backup");
        if (!backup) {
          alert("Aucune sauvegarde automatique disponible.");
          return;
        }
        
        try {
          const data = JSON.parse(backup);
          if (data.classes && data.globalScores && data.subjectScores && data.gameHistory) {
            localStorage.setItem("classes", JSON.stringify(data.classes));
            localStorage.setItem("globalScores", JSON.stringify(data.globalScores));
            localStorage.setItem("subjectScores", JSON.stringify(data.subjectScores));
            localStorage.setItem("gameHistory", JSON.stringify(data.gameHistory));
            alert("Sauvegarde restaur√©e avec succ√®s !");
            updateAdmin();
            updateGlobalRanking();
            updateSubjectRanking();
          } else {
            alert("La sauvegarde est invalide.");
          }
        } catch (e) {
          alert("Erreur lors de la restauration.");
        }
      }
      
      function addManualPoints() {
        const student = document.getElementById("manualStudentSelect").value;
        const pts = parseInt(document.getElementById("manualPoints").value);
        const subject = prompt("Pour quelle mati√®re ?");
        
        if (!student || isNaN(pts) || !subject) return alert("Champs invalides.");
        
        globalScores[student] = (globalScores[student] || 0) + pts;
        if (!subjectScores[subject]) subjectScores[subject] = {};
        subjectScores[subject][student] = (subjectScores[subject][student] || 0) + pts;
        
        localStorage.setItem("globalScores", JSON.stringify(globalScores));
        localStorage.setItem("subjectScores", JSON.stringify(subjectScores));
        alert(+${pts} pts ajout√©s √† ${student} pour ${subject});
        updateGlobalRanking();
        updateSubjectRanking();
      }

      function resetStudentSelections() {
        const checkboxes = document.querySelectorAll('#studentCheckboxes input[type="checkbox"]');
        checkboxes.forEach(cb => cb.checked = false);
      }

      function endLiveGameWithWinner() {
        if (livePlayers.length === 0) return endLiveGame();
        
        const max = Math.max(...livePlayers.map(p => p.score));
        const winners = livePlayers.filter(p => p.score === max);
        const names = winners.map(p => p.name).join(", ");
        
        alert(üéâ Bravo √† ${names} avec ${max} pts !);
        endLiveGame();
      }

      function showAdminTab(tabId) {
        const tabs = document.querySelectorAll('.admin-tab-content');
        tabs.forEach(tab => tab.classList.add('hidden'));
        
        const activeTab = document.getElementById('tab-' + tabId);
        if (activeTab) {
          activeTab.classList.remove('hidden');
        }
        
        if (tabId === "classements") {
          updateGlobalRanking();
          updateSubjectRanking();
        }
        if (tabId === "manuel") {
          updateManualSelects();
        }
        if (tabId === "historique") {
          updateHistoryList();
        }
      }

      document.addEventListener("DOMContentLoaded", () => {
        showAdminTab('gestion'); // On commence par afficher l'onglet gestion
      });

      function showRankingSection() {
        const section = document.getElementById("rankingSection");
        section.style.display = "flex";
        updateGlobalRanking();
        updateClassRanking();
        updateSubjectRanking();
      }

      function toggleRankingSection() {
        const section = document.getElementById("rankingSection");
        const btn = document.getElementById("toggleRankingBtn");
        
        if (section.style.display === "none" || section.style.display === "") {
          section.style.display = "flex";
          btn.textContent = "Cacher les classements";
          updateGlobalRanking();
          updateClassRanking();
          updateSubjectRanking();
        } else {
          section.style.display = "none";
          btn.textContent = "Afficher les classements";
        }
      }

      
      window.onload = function () {
        document.getElementById("rankingSection").classList.add("hidden");
        updateAdmin();
        openPlayerSelection();

      };
    </script>
